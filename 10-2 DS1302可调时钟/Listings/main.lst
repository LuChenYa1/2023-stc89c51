C51 COMPILER V9.59.0.0   MAIN                                                              05/13/2023 19:38:20 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "DS1302.h"
   3          #include "LCD1602.h"
   4          #include "Key.h"
   5          #include "Timer0_Init.h"
   6           
   7          
   8          unsigned char KeyNum,MODE,TimeTypeSelect,FlashFlag;
   9          char DS1302_Time[]={23,4,4,11,20,55,2};
*** WARNING C231 IN LINE 9 OF main.c: 'DS1302_Time': redefinition
  10          //unsigned char i,j;//循环控制变量，但失败了
  11          
  12          void TimeSet();//调整时间函数声明
  13          
  14          void main ()
  15          {
  16   1              LCD_Init();
  17   1              Timer0_Init();
  18   1              DS1302_Init();
  19   1              
  20   1              LCD_ShowString(1,1,"  -  -  ");
  21   1              LCD_ShowString(2,1,"  :  :  ");
  22   1              
  23   1          DS1302_SetTime(); //设置时间
  24   1              while (1)
  25   1              {
  26   2                      P2=0x00;
  27   2                      KeyNum=Key();
  28   2              if(KeyNum)
  29   2                      {
  30   3                              if(KeyNum==1)  //按键一的功能是转换调整模式1和显示模式0
  31   3                              {
  32   4                                      if(MODE==0)MODE=1;
  33   4                                      else if(MODE==1)
  34   4                                      {
  35   5                                              MODE=0; 
  36   5                                              DS1302_SetTime();//显示数值更新后的时间
  37   5                                      }
  38   4                              }
  39   3                      }
  40   2                      switch(MODE)
  41   2                      {
  42   3                              case 0:DS1302_ShowTime();break;
  43   3                              //DS1302_SetTime();放在这里会使时间不断被刷新为同一个值，导致时间不会变化
  44   3                              case 1:TimeSet();break;//调整时间
  45   3                      }
  46   2              }
  47   1      }
  48          void TimeSet()
  49          {
  50   1              if(KeyNum==2)//按键2的功能是转换要调整的数据类型
  51   1              {
  52   2                      TimeTypeSelect++;
  53   2                      TimeTypeSelect%=6;
C51 COMPILER V9.59.0.0   MAIN                                                              05/13/2023 19:38:20 PAGE 2   

  54   2              }
  55   1              LCD_ShowNum(2,10,TimeTypeSelect,2);
  56   1              LCD_ShowNum(2,15,FlashFlag,2);
  57   1              if(KeyNum==3)//按键3对要修改的数据进行增加操作
  58   1              {
  59   2                      DS1302_Time[TimeTypeSelect]++;
  60   2                      /***********防止时间越界*******************/
  61   2                      if(DS1302_Time[0]==100)DS1302_Time[0]=0;
  62   2                      if(DS1302_Time[1]==13)DS1302_Time[1]=1;
  63   2                      
  64   2                      /************天数判断**********************/
  65   2                      if(DS1302_Time[1]==1||DS1302_Time[1]==3
  66   2                      ||DS1302_Time[1]==5||DS1302_Time[1]==7||DS1302_Time[1]==8
  67   2                      ||DS1302_Time[1]==10||DS1302_Time[1]==12 )
  68   2                      {
  69   3                              if(DS1302_Time[2]==32)DS1302_Time[2]=1;
  70   3                      }
  71   2                      if(DS1302_Time[1]==4||DS1302_Time[1]==6
  72   2                      ||DS1302_Time[1]==9||DS1302_Time[1]==11)
  73   2                      {
  74   3                              if(DS1302_Time[2]==31)DS1302_Time[2]=1;
  75   3                      }
  76   2                      /************二月天数判断*******************/
  77   2                      if(DS1302_Time[1]==2)
  78   2                      {
  79   3                              if(DS1302_Time[0]%4==0)if(DS1302_Time[2]==30)DS1302_Time[2]=1;//闰年
  80   3                              if(DS1302_Time[0]%4!=0)if(DS1302_Time[2]==29)DS1302_Time[2]=1;//非闰年
  81   3                      }
  82   2                      /************调整时、分、秒、星期***********/
  83   2                      if(DS1302_Time[3]==24)DS1302_Time[3]=0;
  84   2                      if(DS1302_Time[4]==60)DS1302_Time[4]=0;
  85   2                      if(DS1302_Time[5]==60)DS1302_Time[5]=0;
  86   2                      if(DS1302_Time[6]==8)DS1302_Time[6]=1;
  87   2              }
  88   1              if(KeyNum==4)//按键4对要修改的数据进行减少操作
  89   1              {
  90   2                      DS1302_Time[TimeTypeSelect]--;
  91   2                      /**********防止时间越界********************/
  92   2                      if(DS1302_Time[0]<0)DS1302_Time[0]=100;
  93   2                      if(DS1302_Time[1]<1)DS1302_Time[1]=12;
  94   2                      
  95   2                      /************天数判断**********************/
  96   2                      if(DS1302_Time[1]==1||DS1302_Time[1]==3
  97   2                      ||DS1302_Time[1]==5||DS1302_Time[1]==7||DS1302_Time[1]==8
  98   2                      ||DS1302_Time[1]==10||DS1302_Time[1]==12 )
  99   2                      {
 100   3                              if(DS1302_Time[2]<1)DS1302_Time[2]=31;
 101   3                      }
 102   2                      if(DS1302_Time[1]==4||DS1302_Time[1]==6
 103   2                      ||DS1302_Time[1]==9||DS1302_Time[1]==11)
 104   2                      {
 105   3                              if(DS1302_Time[2]<1)DS1302_Time[2]=30;
 106   3                      }
 107   2                      /************二月天数判断******************/
 108   2                      if(DS1302_Time[1]==2)
 109   2                      {
 110   3                              if(DS1302_Time[0]%4==0)//闰年
 111   3                              {
 112   4                                      if(DS1302_Time[2]<1)DS1302_Time[2]=29;
 113   4                                      if(DS1302_Time[2]>29)DS1302_Time[2]=1;
 114   4                              }
 115   3                              if(DS1302_Time[0]%4!=0)//非闰年
C51 COMPILER V9.59.0.0   MAIN                                                              05/13/2023 19:38:20 PAGE 3   

 116   3                              {
 117   4                                      if(DS1302_Time[2]<1)DS1302_Time[2]=28;
 118   4                                      if(DS1302_Time[2]>28)DS1302_Time[2]=1;
 119   4                              }
 120   3                      }
 121   2                      /************调整时、分、秒、星期***********/
 122   2                      if(DS1302_Time[3]<0)DS1302_Time[3]=23;
 123   2                      if(DS1302_Time[4]<0)DS1302_Time[4]=59;
 124   2                      if(DS1302_Time[5]<0)DS1302_Time[5]=59;
 125   2                      if(DS1302_Time[6]<1)DS1302_Time[6]=7;
 126   2              }
 127   1              /*************想利用循环实现闪烁效果，但失败了********/
 128   1      //      for(j=1;j<3;j++)
 129   1      //      {
 130   1      //               for(i=0;i<3;i++)
 131   1      //              {
 132   1      //                      if(TimeSelect==i && FlashFlag==1) LCD_ShowString(j,1+3i,"  ");
 133   1      //                      else LCD_ShowNum(j,1+3i,DS1302_Time[i],2);
 134   1      //              }
 135   1      //      }
 136   1              /*****************达到闪烁效果********************/
 137   1              if(TimeTypeSelect==0&&FlashFlag==1)LCD_ShowString(1,1,"  ");
 138   1              else LCD_ShowNum(1,1,DS1302_Time[0],2);  //显示年
 139   1              if(TimeTypeSelect==1&&FlashFlag==1)LCD_ShowString(1,4,"  ");
 140   1              else LCD_ShowNum(1,4,DS1302_Time[1],2);  //显示月
 141   1              if(TimeTypeSelect==2&&FlashFlag==1)LCD_ShowString(1,7,"  ");
 142   1              else LCD_ShowNum(1,7,DS1302_Time[2],2);  //显示日
 143   1              if(TimeTypeSelect==3&&FlashFlag==1)LCD_ShowString(2,1,"  ");
 144   1              else LCD_ShowNum(2,1,DS1302_Time[3],2);  //显示时
 145   1              if(TimeTypeSelect==4&&FlashFlag==1)LCD_ShowString(2,4,"  ");
 146   1              else LCD_ShowNum(2,4,DS1302_Time[4],2);  //显示分
 147   1              if(TimeTypeSelect==5&&FlashFlag==1)LCD_ShowString(2,7,"  ");
 148   1              else LCD_ShowNum(2,7,DS1302_Time[5],2);  //显示秒
 149   1              if(TimeTypeSelect==6&&FlashFlag==1)LCD_ShowString(2,12,"  ");
 150   1              else LCD_ShowNum(1,12,DS1302_Time[6],1);  //显示星期
 151   1              if(TimeTypeSelect==6&&FlashFlag==1)LCD_ShowString(1,12,"  ");
 152   1              else LCD_ShowNum(1,12,DS1302_Time[6],1);  //显示星期
 153   1      }
 154          
 155          
 156          /**************每隔0.5秒闪烁一次************/
 157          void Timer0_Routine () interrupt 1
 158          {
 159   1              static unsigned int T0count;     //静态局部变量，保证不会被重新赋值
 160   1      
 161   1              TL0 = 0x66;                                      //确保中断时间不变
 162   1              TH0 = 0xFC;     
 163   1              T0count++;
 164   1              if(T0count == 500)              //每隔500微秒进入if，灯亮灭变化
 165   1              {
 166   2                      T0count=0;
 167   2                      FlashFlag=!FlashFlag;
 168   2              }
 169   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1221    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
C51 COMPILER V9.59.0.0   MAIN                                                              05/13/2023 19:38:20 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
