C51 COMPILER V9.59.0.0   MAIN                                                              05/07/2023 12:25:35 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "nixie.h"
   3          #include "Timer0_Init.h"
   4          #include "Key.h"
   5          #include "UART.h"
   6          #include "delay.h"
   7          
   8          unsigned char knum;
   9          unsigned char h=23,f=59,s=56,h_s,h_g,f_s,f_g,s_s,s_g;
  10          unsigned char TimeSelect,Flag,Sign;
  11           
  12          void main ()
  13          {
  14   1              Timer0_Init();
  15   1              UART_Init();
  16   1              Sign=1;
  17   1          while(1)
  18   1              {
  19   2                      nixie(3,10);
  20   2                      nixie(6,10);
  21   2                      if(TimeSelect==0)
  22   2                      {
  23   3                              nixie(1,h_s);
  24   3                              nixie(2,h_g);   
  25   3                              nixie(4,f_s);   
  26   3                              nixie(5,f_g);
  27   3                              nixie(7,s_s);
  28   3                              nixie(8,s_g);
  29   3                      }
  30   2                      if(TimeSelect==1 && Flag==1){P2=~0x01;
  31   3                      nixie(1,h_s);nixie(2,h_g);nixie(4,f_s);nixie(5,f_g);nixie(7,s_s);nixie(8,s_g);delay(100);}//灯闪烁
  32   2                      if(TimeSelect==1 && Flag==0){P2=0xff;
  33   3                      nixie(1,11 );nixie(2,11);nixie(4,f_s);nixie(5,f_g);nixie(7,s_s);nixie(8,s_g);}//时闪烁
  34   2                      if(TimeSelect==2 && Flag==1){P2=~0x02;
  35   3                      nixie(1,h_s);nixie(2,h_g);nixie(4,f_s);nixie(5,f_g);nixie(7,s_s);nixie(8,s_g);delay(100);}
  36   2                      if(TimeSelect==2 && Flag==0){P2=0xff;
  37   3                      nixie(1,h_s);nixie(2,h_g);nixie(4,11);nixie(5,11);nixie(7,s_s);nixie(8,s_g);}//分闪烁
  38   2                      if(TimeSelect==3 && Flag==1){P2=~0x04;
  39   3                      nixie(1,h_s);nixie(2,h_g);nixie(4,f_s);nixie(5,f_g);nixie(7,s_s);nixie(8,s_g);delay(100);}
  40   2                      if(TimeSelect==3 && Flag==0){P2=0xff;
  41   3                      nixie(1,h_s);nixie(2,h_g);nixie(4,f_s);nixie(5,f_g);nixie(7,11);nixie(8,11);} //秒闪烁
  42   2                              
  43   2                  knum=Key();
  44   2                      if(knum)
  45   2                      {
  46   3                              if(knum==1) 
  47   3                              {
  48   4                                      TimeSelect++;
  49   4                                      TimeSelect%=4;
  50   4                                      
  51   4                                      if(TimeSelect==1&&TimeSelect==2&&TimeSelect==3)
  52   4                                      {
  53   5                                               Sign=1;//停止计时
  54   5                                      }
C51 COMPILER V9.59.0.0   MAIN                                                              05/07/2023 12:25:35 PAGE 2   

  55   4                                      else
  56   4                                      {
  57   5                                              Sign=0;//开始计时
  58   5                                      }
  59   4                              }
  60   3                              if(knum==2)
  61   3                              {
  62   4                                      if(TimeSelect==0)Sign=~Sign;
  63   4                                      if(TimeSelect==1)h++;//加一
  64   4                                      if(TimeSelect==2)f++;
  65   4                                      if(TimeSelect==3)s++;
  66   4                              }
  67   3                              if(knum==3)
  68   3                              {
  69   4                                      if(TimeSelect==0)
  70   4                                      {
  71   5                                              h=0;f=0;s=0;//清零
  72   5                                              Sign=1;//暂停
  73   5                                      }
  74   4                                      if(TimeSelect==1)h--;//减一
  75   4                                      if(TimeSelect==2)f--;
  76   4                                      if(TimeSelect==3)s--;
  77   4                              }
  78   3                              if(knum==4)
  79   3                              {
  80   4                                      if(TimeSelect==1)h=0;//对应变量清零
  81   4                                      if(TimeSelect==2)f=0;
  82   4                                      if(TimeSelect==3)s=0; 
  83   4                                      if(TimeSelect==0)//发送时间
  84   4                                      {
  85   5                                              UART_SendByte(h);
  86   5                                              UART_SendByte(0x3a);
  87   5                                              UART_SendByte(f);
  88   5                                              UART_SendByte(0x3a);
  89   5                                              UART_SendByte(s);
  90   5                                      }
  91   4                              }
  92   3                      }
  93   2                      
  94   2              }
  95   1      }
  96          
  97          void Timer0_Routine() interrupt 1
  98          {
  99   1              static unsigned int T0Count1,T0Count2;
 100   1              TL0 = 0x66;              
 101   1              TH0 = 0xFC;     
 102   1              if(Sign==0)
 103   1              {
 104   2                      T0Count1++;
 105   2                      if(T0Count1>=1000)
 106   2                      {
 107   3                              T0Count1=0;
 108   3                              s++;
 109   3                              if(s==60)
 110   3                              {
 111   4                                      s=0;
 112   4                                      f++;
 113   4                                      if(f==60)
 114   4                                      {
 115   5                                              f=0;
 116   5                                              h++;
C51 COMPILER V9.59.0.0   MAIN                                                              05/07/2023 12:25:35 PAGE 3   

 117   5                                              if(h==24)
 118   5                                              {
 119   6                                                      h=0;
 120   6                                              }
 121   5                                      }
 122   4                              }
 123   3                              h_s=h/10;
 124   3                              h_g=h%10;
 125   3                              f_s=f/10;
 126   3                              f_g=f%10;
 127   3                              s_s=s/10;
 128   3                              s_g=s%10;
 129   3                      }
 130   2              }
 131   1              T0Count2++;
 132   1              if(T0Count2==500)
 133   1              {
 134   2                      T0Count2=0;
 135   2                      Flag=~Flag;
 136   2              }
 137   1               
 138   1      }
 139           
 140          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    903    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
