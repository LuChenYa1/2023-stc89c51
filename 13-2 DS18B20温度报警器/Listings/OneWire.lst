C51 COMPILER V9.59.0.0   ONEWIRE                                                           04/15/2023 10:51:53 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\O
                    -neWire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGX51.H>
   2          #include <INTRINS.H>
   3          
   4          unsigned char ACKBit;
   5          sbit OneWire_DQ = P3^7;
   6           
   7          
   8          /**
   9            * @brief  初始化，开始执行读写操作
  10            * @param  无
  11            * @retval 0应答，1非应答
  12            */
  13          unsigned char OneWire_Init(void)
  14          {
  15   1              unsigned char ACKBit;
  16   1              unsigned char i;
  17   1              EA=0;               //防止中断干扰时序进程
  18   1              OneWire_DQ=1;
  19   1              OneWire_DQ=0;
  20   1              i = 227;while (--i);//延时500us：主线拉低至少480us
  21   1              OneWire_DQ=1;       //释放置一
  22   1              i = 30;while (--i); //延时70us：置一等待15~60us后，从机才会响应，为确保从机在置一时响应，延时比60长
  23   1              ACKBit=OneWire_DQ;
  24   1              i = 227;while (--i);//延时500us:保证时长
  25   1              EA=1;               //时序结束，开启中断
  26   1              return ACKBit;      //单总线的劣势：和中断冲突
  27   1      }
  28          
  29          
  30          /**
  31            * @brief  主机向从机发送一位
  32            * @param  Bit，要发送的位的值（0/1）
  33            * @retval 无
  34            */
  35          void OneWire_SendBit(unsigned char Bit)
  36          {
  37   1              unsigned char i;            //变量声明要放在最前面，否则会报错C141
  38   1              EA=0;
  39   1              OneWire_DQ=0;               //拉低
  40   1              _nop_();i = 4;while (--i);  //延时10us,去掉函数头调用的4us，设定14us，实际运行10us
  41   1              OneWire_DQ=Bit;             //将要输入的值写进去
  42   1              i = 23;while (--i);         //延时50us
  43   1              OneWire_DQ=1;               //释放
  44   1              EA=1;
  45   1      }
  46          
  47          
  48          /**
  49            * @brief  主机接收从机发来的一位的值
  50            * @param  无
  51            * @retval 返回一位的值
  52            */
  53          unsigned char OneWire_ReceiveBit(void)
  54          {
C51 COMPILER V9.59.0.0   ONEWIRE                                                           04/15/2023 10:51:53 PAGE 2   

  55   1              unsigned char Bit,i;
  56   1              EA=0;
  57   1              OneWire_DQ=0;              //拉低
  58   1              _nop_();i = 1;while (--i); //延时5us
  59   1              OneWire_DQ=1;               //释放
  60   1          _nop_();i = 1;while (--i); //延时5us
  61   1              Bit=OneWire_DQ;            //查看从机发送过来的值
  62   1              i = 23;while (--i);        //延时50us
  63   1              //主机不释放，由从机负责释放
  64   1              EA=1;
  65   1              return Bit;
  66   1      }
  67          
  68          /**
  69            * @brief  主机发送一个字节
  70            * @param  Byte，要发送的字节的值
  71            * @retval 无
  72            */
  73          void OneWire_SendByte(unsigned char Byte)
  74          {
  75   1              unsigned char j;
  76   1              for(j=0;j<8;j++)
  77   1              {
  78   2                      OneWire_SendBit(Byte&(0x01<<j));
  79   2              }
  80   1      }
  81          
  82          
  83          /**
  84            * @brief  主机接收一个字节
  85            * @param  无
  86            * @retval 返回接收的字节的值
  87            */
  88          unsigned char OneWire_ReceiveByte(void)
  89          {
  90   1              unsigned char j;
  91   1              unsigned char Byte=0x00;
  92   1              for(j=0;j<8;j++)
  93   1              {
  94   2                      if(OneWire_ReceiveBit()){Byte|=(0x01<<j);}
  95   2              }
  96   1              return Byte;
  97   1      }
  98          
  99          
 100          
 101          
 102          
 103          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    155    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
