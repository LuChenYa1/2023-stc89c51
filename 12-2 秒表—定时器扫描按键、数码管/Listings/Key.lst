C51 COMPILER V9.59.0.0   KEY                                                               04/23/2023 10:10:52 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\Key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Key.l
                    -st) OBJECT(.\Objects\Key.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "delay.h"
   3          #include <intrins.h>
   4          
   5          typedef unsigned char uchar;
   6          
   7          uchar Scan_KeyNum;
   8          
   9          
  10          /**
  11            * @brief  按下第几个按键，就返回对应的值
  12            * @param  无
  13            * @retval 按键值
  14            */
  15          int Key_GetState(void)
  16          {
  17   1              uchar KeyNum=0;
  18   1              if(P3_1==0){KeyNum=1;}
  19   1              if(P3_0==0){KeyNum=2;}
  20   1              if(P3_2==0){KeyNum=3;}
  21   1              if(P3_3==0){KeyNum=4;}
  22   1              
  23   1              return KeyNum;
  24   1      }
  25          
  26          
  27          /**
  28            * @brief  中断时执行的函数，功能是检测按键落下并返回相应的值，去除了原来的delay和死循环
  29            * @param  无
  30            * @retval 无
  31            */
  32          void Key_Loop(void)
  33          {
  34   1              static uchar laststate,nowstate;
  35   1              laststate=nowstate;
  36   1              nowstate=Key_GetState();
  37   1              
  38   1              if(laststate==1&&nowstate==0)//更换10位置可以按下即变，不需松手
  39   1              {
  40   2                      Scan_KeyNum=1;  
  41   2              }
  42   1              if(laststate==2&&nowstate==0)
  43   1              {
  44   2                      Scan_KeyNum=2;  
  45   2              }
  46   1              if(laststate==3&&nowstate==0)
  47   1              {
  48   2                      Scan_KeyNum=3;  
  49   2              }
  50   1              if(laststate==4&&nowstate==0)
  51   1              {
  52   2                      Scan_KeyNum=4;  
  53   2              }
  54   1      }
C51 COMPILER V9.59.0.0   KEY                                                               04/23/2023 10:10:52 PAGE 2   

  55          
  56          
  57          /**
  58            * @brief  返回按键键码
  59            * @param  无
  60            * @retval 键码
  61            */
  62          unsigned char Key(void)
  63          {
  64   1              uchar temp;
  65   1              temp = Scan_KeyNum;     //返回按键值前对Scan_KeyNum清零,防止不按下时返回原值
  66   1              Scan_KeyNum = 0;
  67   1              return temp;
  68   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     94    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
