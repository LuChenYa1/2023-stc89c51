C51 COMPILER V9.59.0.0   MAIN                                                              03/26/2024 20:59:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "UART.h"
   3          #include "OLED.h"
   4          #include "delay.h"
   5          #include "Servo.h"
   6          #include "AT24C02.h"
   7          #include "XPT2046.h"
   8          #include "MatrixKey.h"
   9          #include "Timer0_Init.h"
  10          
  11          #define RainSensor                                              P0_4//é›¨æ»´ä¼ æ„Ÿå¼•è„š
  12          #define Pin_Mode                                                P2_2//è¯­éŸ³-å·¥ä½œæ¨¡å¼å¼•è„š
  13          #define Pin_Action                                              P2_3//è¯­éŸ³-èˆµæœºåŠ¨ä½œå¼•è„š
  14          #define Pin_Speech_MatrixAndBlueTooth   P2_4//è¯­éŸ³-é”®ç›˜-è“ç‰™æ§åˆ¶æ¨¡å¼è½¬æ¢å¼•è„š
  15          
  16          #define Withdraw 1 
  17          #define Manual 1
  18          #define Extend 0
  19          #define Auto 0
  20          #define Rain 0
  21          #define Dry  1
  22          #define Speech_Contral 1
  23          #define MatrixAndBlueTooth_Contral 0
  24          #define Enable 1
  25          #define Disable 0
  26          
  27          uint8_t LightPower = 0, LightPower_Limit = 0, LightPower_Limit_Temp = 0,Flag_SetLightPower, //å…‰å¼ºã€å…‰
             -å¼ºé˜ˆå€¼ã€ä¸­é—´å€¼ã€æ ‡å¿—ä½ï¼ˆæ˜¯å¦å¼€å§‹è®¾ç½®å…‰å¼ºé˜ˆå€¼ï¼‰
  28          MatrixKeyNum = 0, Num_Count = 0, Pressed_Count = 0,  //æŒ‰é”®é”®ç ã€è¾“å…¥æ•°å­—ä½æ•°ã€æŒ‰é”®æŒ‰ä¸‹æ¬¡
             -æ•°
  29          Mode = 0, Action = 0, Flag_Speech_MatrixAndBlueTooth,//æ ‡å¿—ä½ï¼šæ‰‹åŠ¨/è‡ªåŠ¨æ¨¡å¼ã€æ”¶å›/ä¼¸å‡ºæ¨¡å
             -¼ã€é”®ç›˜/è¯­éŸ³/è“ç‰™æ§åˆ¶æ¨¡å¼
  30          BlueTooth_Value = 0, BlueTooth_Mode = 0;             //è“ç‰™æ¥æ”¶å€¼ã€è“ç‰™æ¨¡å¼
  31          
  32          void Speech_Recognition(void);
  33          void BlueTooth_Contral(void);
  34          void OLED_Show(void);
  35          
  36          void main ()        
  37          {
  38   1              UART_Init();
  39   1              Timer0_Init();
  40   1              OLED_Init();
  41   1          OLED_Clear();
  42   1              
  43   1              OLED_ShowString(0, 0, "Lg:", 16);
  44   1              OLED_ShowString(63, 0, "Bound:", 16);
  45   1              OLED_ShowString(63, 6, "Count:", 16);
  46   1              
  47   1              while(1)
  48   1              {               
  49   2                      /*******************************************æŒ‰é”®æ§åˆ¶æ¨¡å¼è®¾ç½®************************************
             -****************************/
  50   2                      
C51 COMPILER V9.59.0.0   MAIN                                                              03/26/2024 20:59:56 PAGE 2   

  51   2                      MatrixKeyNum = MatrixKey();                           //å…¨å±€æ‰«æçŸ©é˜µé”®ç›˜
  52   2                      OLED_ShowNum(110, 6, Pressed_Count, 2, 16);           //æ˜¾ç¤ºæ€»æŒ‰ä¸‹æ¬¡æ•°           
  53   2                      if(MatrixKeyNum != 0)                                     
  54   2                      { 
  55   3                              Pressed_Count++;                                  //æŒ‰é”®æŒ‰ä¸‹æ¬¡æ•°åŠ ä¸€
  56   3                              
  57   3                              if(MatrixKeyNum <= 10)                                /***æŒ‰é”®1~10è¾“å…¥å…‰å¼ºé˜ˆå€¼***/
  58   3                              {
  59   4                                      if(Flag_SetLightPower == Enable)
  60   4                                      {
  61   5                                              if(Num_Count < 2)                         //æœ€å¤§ä½æ•°ä¸º2
  62   5                                              {
  63   6                                                      LightPower_Limit_Temp *= 10;          //æ–°è¾“å…¥çš„æ•°å­—ä½œä¸ªä½
  64   6                                                      LightPower_Limit_Temp += MatrixKeyNum % 10;//è¾“å…¥10å³ä¸º0
  65   6                                                      Num_Count++;                          //è¾“å…¥ä¸€ä¸ªæ•°ï¼Œæ€»ä½æ•°åŠ ä¸€
  66   6                                              }       
  67   5                                      }               
  68   4                              }
  69   3                              else if(MatrixKeyNum == 11)                       /***æŒ‰é”®11å¼€å§‹ï¼ˆæˆ–é‡æ–°ï¼‰è¾“å…¥å…‰å¼ºé˜ˆå€¼**
             -*/
  70   3                              {
  71   4                                      Flag_SetLightPower = Enable; 
  72   4                                      Num_Count = 0;
  73   4                                      LightPower_Limit = 0;
  74   4                              }
  75   3                              else if(MatrixKeyNum == 12)                       /***æŒ‰é”®12ç¡®è®¤æœ€ç»ˆå…‰å¼ºé˜ˆå€¼***/
  76   3                              {
  77   4                                      LightPower_Limit = LightPower_Limit_Temp;
  78   4                                      Flag_SetLightPower = Disable;
  79   4                                      Num_Count = 2;
  80   4                                      AT24C02_WriteByte(0, LightPower_Limit);       //å­˜å‚¨å…‰å¼ºé˜ˆå€¼ï¼Œä½ç½®0
  81   4                              }
  82   3                              /************ä»¥ä¸‹æ˜¯åŠŸèƒ½æŒ‰é”®***********/
  83   3                              else if(MatrixKeyNum == 13)                       /***æŒ‰é”®13åˆ‡æ¢æ‰‹åŠ¨/è‡ªåŠ¨å·¥ä½œæ¨¡å¼***/
  84   3                              {
  85   4                                      if(Pin_Speech_MatrixAndBlueTooth == MatrixAndBlueTooth_Contral)Mode = !Mode;//é”®ç›˜è“ç‰™æ§åˆ¶æ¨¡å¼
             -è¯¥é”®æœ‰æ•ˆ
  86   4                              }
  87   3                              else if(MatrixKeyNum == 14)                       /***æŒ‰é”®14æ”¶å›/ä¼¸å‡ºæ™¾è¡£æ¶***/
  88   3                              {
  89   4                                      if(Mode == Auto)Mode = Manual;                //è‡ªåŠ¨å·¥ä½œæ¨¡å¼ä¸‹ï¼ŒæŒ‰ä¸‹æŒ‰é”®ï¼Œè½¬æ¢æ‰‹åŠ¨å·¥
             -ä½œæ¨¡å¼
  90   4                                      Action = !Action;                                                     //æ‰‹åŠ¨å·¥ä½œæ¨¡å¼å¯æ”¶å›/ä¼¸å‡ºï¼Œéé›¨å¤©
  91   4                              }
  92   3      //                      else if(MatrixKeyNum == 15)                       /***æŒ‰é”®15è½¬æ¢é”®ç›˜/è¯­éŸ³è“ç‰™æ§åˆ¶ï¼ŒåŠ å…
             -¥è¯­éŸ³è½¬æ¢åè¯¥é”®å¤±æ•ˆ***/
  93   3      //                      {
  94   3      //                              Flag_Speech_MatrixAndBlueTooth = !Flag_Speech_MatrixAndBlueTooth;
  95   3      //                      }
  96   3                      }       
  97   2                      
  98   2                      /***********************************************è¯­éŸ³/é”®ç›˜/è“ç‰™æ§åˆ¶æ¨¡å¼è½¬æ¢******************
             -*******************************************/
  99   2                      
 100   2                      //ä½¿ç”¨è¯­éŸ³æ§åˆ¶æ¨¡å¼æ—¶ï¼Œå…¶ä»–ä¸¤ç§æ— æ•ˆï¼Œä½†é”®ç›˜å’Œè“ç‰™æ§åˆ¶æ¨¡å¼å¯ä»¥å…±å­˜ï¼Œå› ä¸º
             -è¯­éŸ³ç”µå¹³ä¸å˜ï¼Œä½†è“ç‰™å’Œé”®ç›˜è¿›å…¥ä¸€æ¬¡å³æ¸…é›¶
 101   2                      if(Pin_Speech_MatrixAndBlueTooth == Speech_Contral)//è¯†åˆ«è¯­éŸ³è½¬æ¢å¯¹åº”æ§åˆ¶æ¨¡å¼
 102   2                              Flag_Speech_MatrixAndBlueTooth = Speech_Contral;  
 103   2                      else if(Pin_Speech_MatrixAndBlueTooth == MatrixAndBlueTooth_Contral)
 104   2                              Flag_Speech_MatrixAndBlueTooth = MatrixAndBlueTooth_Contral;
 105   2                      
 106   2                      //æ ¹æ®æ ‡å¿—ä½å¯åŠ¨å¯¹åº”æ§åˆ¶ç¨‹åº
C51 COMPILER V9.59.0.0   MAIN                                                              03/26/2024 20:59:56 PAGE 3   

 107   2                      if(Flag_Speech_MatrixAndBlueTooth == Speech_Contral)Speech_Recognition();
 108   2                      else if(Flag_Speech_MatrixAndBlueTooth == MatrixAndBlueTooth_Contral)BlueTooth_Contral();
 109   2                      
 110   2                      /**********************************************è‡ªåŠ¨/æ‰‹åŠ¨å·¥ä½œæ¨¡å¼åŠŸèƒ½è®¾ç½®********************
             -*************************************/
 111   2                      
 112   2                      if(Mode == Auto)                                      /***è‡ªåŠ¨å·¥ä½œæ¨¡å¼è®¾ç½®***/
 113   2                      {
 114   3                              if(LightPower > LightPower_Limit && RainSensor == Dry)Action = Extend;//ç™½å¤©/æ™´å¤©è‡ªåŠ¨ä¼¸å‡ºæ™¾æ™’
             -ï¼ˆéé›¨å¤©ï¼‰ï¼Œé˜²æ­¢å¤ªé˜³é›¨ 
 115   3                              else Action = Withdraw;                               //é»‘å¤œ/é˜´å¤©/é›¨å¤©è‡ªåŠ¨æ”¶å›é˜²æ½®/é›¨
 116   3                      }
 117   2                      if(Mode == Manual){}                                  /***æ‰‹åŠ¨å·¥ä½œæ¨¡å¼è®¾ç½®***/
 118   2                      
 119   2                      /******************************ç‹¬ç«‹äºæ¨¡å¼ä¹‹å¤–çš„è§„åˆ™ï¼šæœ‰é›¨æ—¶å¼ºåˆ¶æ”¶å›æ™¾è¡£æ¶ï¼Œæ— æ³•è
             -¿›è¡Œå…¶ä»–åŠ¨ä½œ***********************************/
 120   2                      
 121   2                      if(RainSensor == Rain)Action = Withdraw;                  
 122   2              
 123   2                      /**********************************************å½“ä¸€åˆ‡å°˜åŸƒè½åœ°ï¼ˆæ˜¾ç¤ºæŒ‡ä»¤åŠæ•°æ®ï¼‰*********
             -************************************/
 124   2                              
 125   2                      OLED_Show();    
 126   2                      
 127   2                      /***************************************************æ”¶å°¾ï¼ˆæœ€ç»ˆæŒ‰æŒ‡ä»¤æ‰§è¡Œæ”¶å›/ä¼¸å‡ºåŠ¨ä½œï¼‰
             -*************************************************/
 128   2                      
 129   2                      if(Action == Withdraw)contral_1();                      //æ”¶å›è¡£æœ
 130   2                      else if(Action == Extend)contral_4();                   //æ™¾æ™’è¡£æœ
 131   2              }                    
 132   1      }
 133          
 134          
 135          /*********************************************************************************** 
 136          å‡½æ•°åç§°:Speech_Recognition
 137          å‡½æ•°åŠŸèƒ½:è¯­éŸ³æ§åˆ¶ï¼ˆç”µå¹³æ£€æµ‹ï¼‰ï¼Œç¼ºé™·ï¼šè¯­éŸ³æ§åˆ¶æ¨¡å¼ä¸‹ï¼ŒæŒ‰é”®æ¨¡å¼å¤±æ•ˆ
 138          ***********************************************************************************/
 139          void Speech_Recognition(void)
 140          {
 141   1              if(Pin_Mode == Manual)Mode = Manual;            //è¯­éŸ³æ§åˆ¶å·¥ä½œæ¨¡å¼
 142   1              else if(Pin_Mode == Auto)Mode = Auto;
 143   1              if(Pin_Action == Withdraw)Action = Withdraw;//è¯­éŸ³æ§åˆ¶æ”¶ä¼¸
 144   1              else if(Pin_Action == Extend)Action = Extend;
 145   1      }
 146          
 147          
 148          /*********************************************************************************** 
 149          å‡½æ•°åç§°:BlueTooth_Contral
 150          å‡½æ•°åŠŸèƒ½:è“ç‰™æ§åˆ¶æ¨¡å¼(ç±»ä¼¼é”®ç›˜)
 151          ***********************************************************************************/
 152          void BlueTooth_Contral(void)
 153          {
 154   1              if(BlueTooth_Mode == 1)                                    //æ”¶å›ä¼¸å‡ºæ™¾è¡£æ¶
 155   1              {
 156   2                      if(Mode == Auto)Mode = Manual;         //è‡ªåŠ¨å·¥ä½œæ¨¡å¼ä¸‹ï¼ŒæŒ‰ä¸‹æŒ‰é”®ï¼Œè½¬æ¢æ‰‹åŠ¨æ¨¡å¼
 157   2                      Action = !Action;
 158   2                      BlueTooth_Mode = 0;
 159   2              }
 160   1              else if(BlueTooth_Mode == 2)               //è½¬æ¢æ‰‹åŠ¨/è‡ªåŠ¨å·¥ä½œæ¨¡å¼
 161   1              {
 162   2                      if(Pin_Speech_MatrixAndBlueTooth == MatrixAndBlueTooth_Contral)Mode = !Mode;
 163   2                      BlueTooth_Mode = 0;
C51 COMPILER V9.59.0.0   MAIN                                                              03/26/2024 20:59:56 PAGE 4   

 164   2              }
 165   1              else if(BlueTooth_Mode == 3)               //å¼€å§‹ï¼ˆæˆ–é‡æ–°ï¼‰è¾“å…¥å…‰å¼ºé˜ˆå€¼
 166   1              {
 167   2                      Flag_SetLightPower = Enable; 
 168   2                      Num_Count = 0;
 169   2                      LightPower_Limit = 0;
 170   2                      BlueTooth_Mode = 0;
 171   2              }
 172   1              else if(BlueTooth_Mode == 4)               //ç¡®è®¤æœ€ç»ˆå…‰å¼ºé˜ˆå€¼
 173   1              {
 174   2                      LightPower_Limit = LightPower_Limit_Temp;
 175   2                      Flag_SetLightPower = Enable;
 176   2                      Num_Count = 2;
 177   2                      AT24C02_WriteByte(0, LightPower_Limit);//å­˜å‚¨å…‰å¼ºé˜ˆå€¼ï¼Œä½ç½®1
 178   2                      BlueTooth_Mode = 0;
 179   2              }
 180   1      }
 181          
 182          
 183          //è“ç‰™ä¸²å£ä¸­æ–­å‡½æ•°
 184          void UART_Routine()   interrupt 4  
 185          {
 186   1              if(RI == 1)                      
 187   1              {
 188   2                      RI = 0;                     //æ‰‹åŠ¨å¤ä½ 
 189   2                      BlueTooth_Value = SBUF; 
 190   2                      switch(BlueTooth_Value)
 191   2                      {
 192   3                              case 0x01:BlueTooth_Mode = 1;break;
 193   3                              case 0x02:BlueTooth_Mode = 2;break;
 194   3                              case 0x03:BlueTooth_Mode = 3;break; 
 195   3                              case 0x04:BlueTooth_Mode = 4;break; 
 196   3                      } 
 197   2                      UART_SendByte(BlueTooth_Value);
 198   2              }
 199   1      }
 200          
 201          
 202          /*********************************************************************************** 
 203          å‡½æ•°åç§°:OLED_Show
 204          å‡½æ•°åŠŸèƒ½:OLEDæ˜¾ç¤ºå„é¡¹å‘½ä»¤åŠæ£€æµ‹æ•°æ®
 205          ***********************************************************************************/
 206          void OLED_Show(void)
 207          {
 208   1              LightPower_Limit = AT24C02_ReadByte(0);                                    //å°†å­˜å‚¨çš„å…‰å¼ºé˜ˆå€¼å–å‡ºæ¥
 209   1              OLED_ShowNum(110,0,LightPower_Limit,2, 16);                                //æ˜¾ç¤ºå…‰å¼ºé˜ˆå€¼
 210   1              LightPower = XPT2046_ReadAD(XPT2046_VBAT_8) * 4;                   //è¯»å–å…‰å¼ºï¼ˆ0 ~ 100ï¼‰
 211   1              OLED_ShowNum(23, 0,LightPower, 2, 16);                             //æ˜¾ç¤ºå…‰å¼º
 212   1      //      LightPower = XPT2046_ReadAD(XPT2046_YP_8) * 4;                     //è¯»å–æ¸©åº¦ï¼ˆ0 ~ 100ï¼‰
 213   1      //      OLED_ShowNum(47, 2,LightPower, 2, 16);                             //æ˜¾ç¤ºæ¸©åº¦
 214   1              
 215   1              if(LightPower < LightPower_Limit)OLED_ShowString(0, 2,"Night", 16);//æ˜¾ç¤ºç™½å¤©
 216   1              else OLED_ShowString(0, 2, "Day  ", 16);                                           //æ˜¾ç¤ºé»‘å¤œ
 217   1              
 218   1              if(RainSensor == Rain)OLED_ShowString(94, 2, "Rain", 16);          //æ˜¾ç¤ºæœ‰é›¨
 219   1              else if(RainSensor == Dry)OLED_ShowString(94, 2, "Dry ", 16);      //æ˜¾ç¤ºæ— é›¨
 220   1              
 221   1              if(Mode == Manual)OLED_ShowString(0, 4, "Manual", 16);             //æ˜¾ç¤ºæ‰‹åŠ¨æ¨¡å¼
 222   1              else if(Mode == Auto)OLED_ShowString(0, 4, "Auto  ", 16);          //æ˜¾ç¤ºè‡ªåŠ¨æ¨¡å¼
 223   1      
 224   1              if(Action == Withdraw)OLED_ShowString(63, 4, "Withdraw", 16);      //æ˜¾ç¤ºæ”¶å›æ™¾è¡£æ¶
 225   1              else if(Action == Extend)OLED_ShowString(63, 4, "Extend  ", 16);   //æ˜¾ç¤ºä¼¸å‡ºæ™¾è¡£æ¶
C51 COMPILER V9.59.0.0   MAIN                                                              03/26/2024 20:59:56 PAGE 5   

 226   1              
 227   1              if(Flag_Speech_MatrixAndBlueTooth == Speech_Contral)OLED_ShowString(0, 6, "Speak ", 16);//æ˜¾ç¤ºè¯­éŸ³æ§
             -åˆ¶æ¨¡å¼
 228   1              else if(Flag_Speech_MatrixAndBlueTooth == MatrixAndBlueTooth_Contral)OLED_ShowString(0, 6, "Matrix", 16);
             -//æ˜¾ç¤ºéè¯­éŸ³æ§åˆ¶
 229   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    961    ----
   CONSTANT SIZE    =     86    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
