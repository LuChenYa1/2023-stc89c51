C51 COMPILER V9.59.0.0   UART                                                              12/26/2023 20:08:27 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\UART.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE UART.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\UART.lst) OBJECT(.\Objects\UART.obj)

line level    source

   1          #include <REGX51.H>
   2          
   3          typedef  unsigned char uint8_t;
   4          
   5          
   6          /*************************************************************************
   7          函数名称：UART_Init
   8          函数功能：设置串口接收模式，也能发送
   9          
  10          **************************************************************************/
  11          void UART_Init(void)      //4800bps@11.0592MHz
  12          {
  13   1                                    //0x50比0x40多了REN=1,允许接收数据
  14   1              SCON = 0x50;          //串口模式1(常用),八位数据，可变波特率，和定时器模式2(八位
             -自动重装)不是一个东西
  15   1              PCON |=0x80;          //最高位置一，其他位不变，波特率加倍(本来是为了减小误差
             -但这里已经无误差，可不加倍)
  16   1              //      AUXR &= 0xBF;     //高级功能，该型号单片机没有     
  17   1              //      AUXR &= 0xFE;     //调12T和定时器1
  18   1              TMOD &=0x0F;          //高四位清零，低四位不变，调定时器1
  19   1          TMOD |=0x20;          //调定时器1的模式二，八位自动重装模式
  20   1              TL1=0xFA;             //设置定时初值
  21   1              TH1=0xFA;             //设定定时器重装值
  22   1              ET1=0;                //禁止定时器1中断，只提供定时功能，中断没有用
  23   1              TR1=1;                //启动定时器
  24   1              //独属于需要接受数据的时候的配置
  25   1              EA=1;                 //开启中断总开关
  26   1              ES=1;                 //开启串口中断
  27   1      }
  28          //定时器1中断的触发条件是时间到了，定时结束，定时器1用来配置波特率，没有
             -必要开启中断
  29          //串口中断的触发条件是接收数据或者发送数据
  30          
  31          
  32          /*************************************************************************
  33          函数名称：:UART_SendByte
  34          函数功能：发送一个字符
  35          
  36          **************************************************************************/
  37          void UART_SendByte(uint8_t byte)
  38          {
  39   1              ES = 0;
  40   1              SBUF=byte;                    //SBUF有两个，一个是发送区，一个是接受区，空间不一样
             -，但占用同一个地址
  41   1              while(TI == 0);
  42   1              TI=0;                         //一旦发送，立即软件复位
  43   1              ES = 1;
  44   1      }
  45          
  46          
  47          /*************************************************************************
  48          函数名称：:UART_SendString
  49          函数功能：发送一个字符串
  50          
C51 COMPILER V9.59.0.0   UART                                                              12/26/2023 20:08:27 PAGE 2   

  51          **************************************************************************/
  52          void UART_SendString(uint8_t *String)
  53          {
  54   1          while(*String)
  55   1          {
  56   2              UART_SendByte(*String);
  57   2              String++;
  58   2          }
  59   1      }
  60          
  61          
  62          /*********************************************************************************** 
  63          函数名称:UART_SendIntNumber
  64          函数功能:串口发送整型数字
  65          
  66          **************************************************************************/
  67          void UART_SendIntNumber(int Number)
  68          {
  69   1          unsigned char NumbArray[6]={0};    // // 定义局部数组，用于数据存储
  70   1          if(Number<0)
  71   1          {
  72   2              Number = 0-Number;
  73   2              UART_SendByte('-');
  74   2          }
  75   1          else
  76   1          {
  77   2             UART_SendByte('+');
  78   2          }
  79   1          
  80   1          NumbArray[0]=(Number/10000)%10+0x30; 
  81   1          NumbArray[1]=(Number/1000) %10+0x30;
  82   1          NumbArray[2]=(Number/100)  %10+0x30;
  83   1          NumbArray[3]=(Number/10)   %10+0x30;
  84   1          NumbArray[4]=(Number/1)    %10+0x30; 
  85   1          NumbArray[5]= 0;     
  86   1          UART_SendString(NumbArray);
  87   1      }
  88          
  89          
  90          /*********************************************************************************** 
  91          函数名称:UART_SendFloatNumber
  92          函数功能:串口发送浮点型数字
  93          ***********************************************************************************/
  94          
  95          void UART_SendFloatNumber(float Number)
  96          {
  97   1          unsigned char NumberArray[11]={0};              // 定义局部数组，用于数据存储
  98   1          unsigned char i=1;                              // 定义局部变量，记录整数位数
  99   1          long j=1;
 100   1          unsigned int Real_Int=0;                        // 定义局部变量，记录整数部分
 101   1          unsigned int Real_Dec=0;                        // 定义局部变量，记录小数部分
 102   1      
 103   1          double Deci=0;                                  // 定义局部数组，暂存小数数值
 104   1          
 105   1          //----------------------------------------------------------------------------------------------
 106   1          // 判断 浮点数字正负
 107   1          //----------------------------------------------------------------------------------------------
 108   1          if(Number<0)
 109   1          {
 110   2              Number=0-Number;
 111   2              UART_SendByte('-');
 112   2          }
C51 COMPILER V9.59.0.0   UART                                                              12/26/2023 20:08:27 PAGE 3   

 113   1          else
 114   1          {
 115   2              UART_SendByte('+');
 116   2          }
 117   1      
 118   1          //----------------------------------------------------------------------------------------------
 119   1          // 分离 整数位与小数位
 120   1          //----------------------------------------------------------------------------------------------
 121   1          Real_Int=(int)Number;                           // 取整数部分
 122   1          Deci    =Number-Real_Int;                       // 取小数部分
 123   1          Real_Dec=(unsigned int)(Deci*1e4);              // 小数变整型数字，1e4科学计数法
 124   1      
 125   1      
 126   1          //----------------------------------------------------------------------------------------------
 127   1          // 串口输出
 128   1          //----------------------------------------------------------------------------------------------
 129   1          NumberArray[0] = (Real_Int/10000)%10+0x30;
 130   1          NumberArray[1] = (Real_Int/1000) %10+0x30;
 131   1          NumberArray[2] = (Real_Int/100)  %10+0x30;
 132   1          NumberArray[3] = (Real_Int/10)   %10+0x30;
 133   1          NumberArray[4] = (Real_Int/1)    %10+0x30;
 134   1          NumberArray[5] = '.';
 135   1          NumberArray[6] = (Real_Dec/1000)%10+0x30;
 136   1          NumberArray[7] = (Real_Dec/100) %10+0x30;
 137   1          NumberArray[8] = (Real_Dec/10)  %10+0x30;
 138   1          NumberArray[9] = (Real_Dec/1)   %10+0x30;
 139   1          NumberArray[10]= 0;
 140   1      
 141   1          UART_SendString(NumberArray);
 142   1      }
 143          
 144          
 145           /**
 146            * @brief  串口中断函数
 147            * @param  无
 148            * @retval 无
 149            */
 150          //void UART_Routine()   interrupt 4 
 151          //{
 152          //      if(RI==1)                     
 153          //      {
 154          //              RI=0;                     
 155          //      }
 156          //}
 157          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    725    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----      36
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
