C51 COMPILER V9.59.0.0   MATRIXKEY                                                         04/23/2023 10:37:01 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MATRIXKEY
OBJECT MODULE PLACED IN .\Objects\Matrixkey.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE Matrixkey.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\Matrixkey.lst) OBJECT(.\Objects\Matrixkey.obj)

line level    source

   1           #include <REGX51.H>
   2           #include <delay.h>
   3           
   4           unsigned char Scan_KeyNum;
   5           /**
   6            * @brief  矩阵键盘读取按键键码
   7            * @param  参数无
   8            * @retval 返回值为键码
   9                  按下并松开后重新赋值并显示
  10            */  
  11           int Matrixkey_GetState()
  12           {
  13   1               //列扫描
  14   1               unsigned int KeyNum=0;
  15   1               P1=0xff;     //全部复位
  16   1               P1_0=0;      //确定扫描列数          
  17   1               if(P1_4==0){ KeyNum=16;}
  18   1               if(P1_5==0){ KeyNum=12;}
  19   1               if(P1_6==0){ KeyNum=8;}
  20   1               if(P1_7==0){ KeyNum=4;}
  21   1               
  22   1               
  23   1               P1=0xff;
  24   1               P1_1=0;
  25   1               if(P1_4==0){ KeyNum=15;}
  26   1               if(P1_5==0){ KeyNum=11;}
  27   1               if(P1_6==0){ KeyNum=7;}
  28   1               if(P1_7==0){ KeyNum=3;}
  29   1               
  30   1               P1=0xff;
  31   1               P1_2=0;
  32   1               if(P1_4==0){ KeyNum=14;}
  33   1               if(P1_5==0){ KeyNum=10;}
  34   1               if(P1_6==0){ KeyNum=6;}
  35   1               if(P1_7==0){ KeyNum=2;}
  36   1               
  37   1               P1=0xff;
  38   1               P1_3=0;
  39   1               if(P1_4==0){ KeyNum=13;}
  40   1               if(P1_5==0){ KeyNum=9;}
  41   1               if(P1_6==0){ KeyNum=5;}
  42   1               if(P1_7==0){ KeyNum=1;}
  43   1               
  44   1               
  45   1               return KeyNum;
  46   1       }
  47           void Matrixkey_Loop(void)
  48          {
  49   1              static unsigned char laststate,nowstate;
  50   1              laststate=nowstate;
  51   1              nowstate=Matrixkey_GetState();
  52   1              
  53   1              if(laststate==0&&nowstate==1)//更换10位置可以按下即变，不需松手
  54   1              {
C51 COMPILER V9.59.0.0   MATRIXKEY                                                         04/23/2023 10:37:01 PAGE 2   

  55   2                      Scan_KeyNum=1;  
  56   2              }
  57   1              if(laststate==0&&nowstate==2)
  58   1              {
  59   2                      Scan_KeyNum=2;  
  60   2              }
  61   1              if(laststate==0&&nowstate==3)
  62   1              {
  63   2                      Scan_KeyNum=3;  
  64   2              }
  65   1              if(laststate==0&&nowstate==4)
  66   1              {
  67   2                      Scan_KeyNum=4;  
  68   2              }
  69   1              
  70   1              if(laststate==0&&nowstate==5)//更换10位置可以按下即变，不需松手
  71   1              {
  72   2                      Scan_KeyNum=5;  
  73   2              }
  74   1              if(laststate==0&&nowstate==6)
  75   1              {
  76   2                      Scan_KeyNum=6;  
  77   2              }
  78   1              if(laststate==0&&nowstate==7)
  79   1              {
  80   2                      Scan_KeyNum=7;  
  81   2              }
  82   1              if(laststate==0&&nowstate==8)
  83   1              {
  84   2                      Scan_KeyNum=8;  
  85   2              }
  86   1              
  87   1              if(laststate==0&&nowstate==9)//更换10位置可以按下即变，不需松手
  88   1              {
  89   2                      Scan_KeyNum=9;  
  90   2              }
  91   1              if(laststate==0&&nowstate==10)
  92   1              {
  93   2                      Scan_KeyNum=10; 
  94   2              }
  95   1              if(laststate==0&&nowstate==11)
  96   1              {
  97   2                      Scan_KeyNum=11; 
  98   2              }
  99   1              if(laststate==0&&nowstate==12)
 100   1              {
 101   2                      Scan_KeyNum=12; 
 102   2              }
 103   1              
 104   1              if(laststate==0&&nowstate==13)//更换10位置可以按下即变，不需松手
 105   1              {
 106   2                      Scan_KeyNum=13; 
 107   2              }
 108   1              if(laststate==0&&nowstate==14)
 109   1              {
 110   2                      Scan_KeyNum=14; 
 111   2              }
 112   1              if(laststate==0&&nowstate==15)
 113   1              {
 114   2                      Scan_KeyNum=15; 
 115   2              }
 116   1              if(laststate==0&&nowstate==16)
C51 COMPILER V9.59.0.0   MATRIXKEY                                                         04/23/2023 10:37:01 PAGE 3   

 117   1              {
 118   2                      Scan_KeyNum=16; 
 119   2              }
 120   1      }
 121          
 122          
 123          unsigned char Matrixkey(void)
 124          {
 125   1              unsigned char temp;
 126   1              temp = Scan_KeyNum;     //返回按键值前对Scan_KeyNum清零,防止不按下时返回原值
 127   1              Scan_KeyNum = 0;
 128   1              return temp;
 129   1      }
 130           
 131          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    372    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
