C51 COMPILER V9.59.0.0   MATRIXLED                                                         12/05/2023 18:14:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MATRIXLED
OBJECT MODULE PLACED IN .\Objects\MatrixLED.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE MatrixLED.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\MatrixLED.lst) OBJECT(.\Objects\MatrixLED.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "delay.h"
   3          #define MatrixLED_lie P0       //提高可读性，方便后期替换操作寄存器
   4          
   5          typedef  unsigned char uchar;
   6          extern int i;                  //变量名在头文件中定义要加extern，防止重定义，告诉系统这是同一个变量
   7          
   8          //对位进行重命名，不能用_,要用^
   9          sbit SER = P3^4;               //串行数据，一次赋值一位
  10          sbit SCK = P3^6;               //串行时钟，每输入一位就触发该时钟将数据上移，一直移到最高位DH
  11          sbit RCK = P3^5;               //寄存器时钟，存满8位后触发RCK=1，将八位数据并行输入到DH~DA（D7到D1）
  12          
  13          /**
  14            * @brief    初始化寄存器时钟和串行时钟
  15            * @param    无
  16            * @retval   无
  17            */
  18          void MatrixLED_Init()
  19          {
  20   1              SCK=0;        //SCK需要手动复位和开启
  21   1              RCK=0;        //RCK需要手动复位和开启
  22   1      }
  23                  
  24                  
  25          /**
  26            * @brief  顺序将byte从高到低的数值赋值给SER,再传递给D7到D0
  27            * @param  一列显示的段码，1亮
  28            * @retval 无
  29            */
  30          void _74HC595_SendByte(uchar byte)
  31          {
  32   1              for( i=0;i<8;i++)
  33   1              {
  34   2                      SER = byte & (0x80>>i);  
  35   2                      SCK = 1;  //上移一位
  36   2                      SCK = 0;  //复位
  37   2              }
  38   1              RCK = 1;      //并行输入8位
  39   1              RCK = 0;      //复位
  40   1              //不用自己清零SER，会有问题，直接再次赋值就可以
  41   1      }
  42          
  43          
  44          /**
  45            * @brief  在第几列显示对应段码
  46            * @param  列数，段码
  47            * @retval 无
  48            */
  49          
  50          void MatrixLED_ShowColumn(uchar Column,Data)
  51          {
  52   1              _74HC595_SendByte(Data);         //段选，第几行
  53   1              MatrixLED_lie = ~(0x80>>Column);   //位选，第几列，0亮
  54   1              delay(1);
C51 COMPILER V9.59.0.0   MATRIXLED                                                         12/05/2023 18:14:56 PAGE 2   

  55   1              MatrixLED_lie = 0xff;
  56   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     95    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
