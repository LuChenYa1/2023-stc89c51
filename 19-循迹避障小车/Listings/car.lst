C51 COMPILER V9.59.0.0   CAR                                                               12/29/2023 20:28:54 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE CAR
OBJECT MODULE PLACED IN .\Objects\car.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE car.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\car.l
                    -st) OBJECT(.\Objects\car.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "Timer0_Init.h"
   3          #include "motor.h"
   4          #include "chaoshengbo.h"
   5          #include "delay.h"
   6          
   7          
   8          //转向用制动调节，速度用使能调节
   9          //1使能
  10          sbit ENA = P0^2;//right
  11          sbit ENB = P0^3;//left
  12          unsigned char T0count3;
  13          
  14          //舵机模块
  15          unsigned char Targetdistance = 30;//30cm限制距离
  16          unsigned char distance1,distance2,distance3;//三个方向距离
  17          unsigned char angle;
  18          sbit PWM = P0^7;//1~5转动角度代码
  19          
  20          unsigned char Speed_A,Speed_B;//速度满20
  21          void Car_Go()//向前直行
  22          {
  23   1              Speed_A = 4;Speed_B = 4;
  24   1              Left_go();
  25   1              Right_go();
  26   1      }
  27          
  28          void Car_Back()//向后直行
  29          {
  30   1              Speed_A = 4;Speed_B = 4;
  31   1              Left_back();
  32   1          Right_back();
  33   1      }
  34          
  35          void Car_Stop()//停止
  36          {
  37   1              Speed_A = 0;Speed_B = 0;
  38   1              Left_stop();
  39   1              Right_stop();
  40   1      }
  41          
  42          void Car_LeftGo()//原地向前左拐
  43          {
  44   1              Speed_A = 10;Speed_B = 6;
  45   1              //Left_stop();
  46   1              Left_back();
  47   1              Right_go();
  48   1      }
  49          
  50          void Car_RightGo()//原地向前右拐
  51          {
  52   1              Speed_B = 10;Speed_A = 6;
  53   1              //Right_stop();
  54   1              Right_back();
C51 COMPILER V9.59.0.0   CAR                                                               12/29/2023 20:28:54 PAGE 2   

  55   1              Left_go();
  56   1      }
  57          
  58          void Car_LeftBack()//原地向后左拐
  59          {
  60   1              Speed_A = 10;Speed_B = 5;
  61   1              Left_go();//Left_stop();
  62   1              Right_back();
  63   1      }
  64          
  65          void Car_RightBack()//原地向后右拐
  66          {
  67   1              Speed_B = 10;Speed_A = 5;
  68   1              Right_go();             //Right_stop();
  69   1              Left_back();
  70   1      }
  71          
  72          void Timer0_Routine () interrupt 1
  73          {
  74   1              static unsigned int T0count1,T0count2;      
  75   1      
  76   1              TL0 = 0x33;                                      //Ensure that the interrupt time is constant
  77   1              TH0 = 0xFE;     
  78   1              //Adjust the speed of the right wheel
  79   1              T0count1++;
  80   1              if(T0count1 == 20)              //Come in every 500 微秒，共10ms
  81   1              {
  82   2                      T0count1=0;
  83   2              }
  84   1              if(T0count1 <= Speed_A)
  85   1              {
  86   2                      ENA = 1;
  87   2                      //ENB = 1;
  88   2              }
  89   1              else
  90   1              {
  91   2                      ENA = 0;
  92   2                      //ENB = 0;
  93   2              }
  94   1              
  95   1              //Adjust the speed of the left wheel
  96   1              T0count2++;
  97   1              if(T0count2 == 20)              //Come in every 500 微秒
  98   1              {
  99   2                      T0count2 = 0;
 100   2              }
 101   1              if(T0count2 <= Speed_B)
 102   1              {
 103   2                      ENB = 1;
 104   2              }
 105   1              else
 106   1              {
 107   2                      ENB = 0;
 108   2              }
 109   1              
 110   1      //舵机转动角度控制
 111   1              T0count3++;
 112   1              if(T0count3 == 40)              //Come in every 500 微秒
 113   1              {
 114   2                      T0count3 = 0;
 115   2              }
 116   1              if(T0count3 <= angle)
C51 COMPILER V9.59.0.0   CAR                                                               12/29/2023 20:28:54 PAGE 3   

 117   1              {
 118   2                       PWM = 1;
 119   2              }
 120   1              else
 121   1              {
 122   2                       PWM = 0;
 123   2              }
 124   1      }
 125          
 126          void contral_0(void)//0右90，1右45，2中间，3左45，4左90，
 127          {
 128   1              angle = 0;   //转动90度
 129   1              delay(100);
 130   1      }
 131          void contral_4(void)//0右90，1右45，2中间，3左45，4左90，
 132          {
 133   1              angle = 4;   //转动90度
 134   1              delay(100);
 135   1      }void contral_1(void)//0右90，1右45，2中间，3左45，4左90，
 136          {
 137   1              angle = 1;   //转动90度
 138   1              delay(100);
 139   1      }
 140          
 141          
 142          void contral(void)
 143          {
 144   1              T0count3 = 0;
 145   1              angle = 3;   //左转动45度
 146   1              delay(400);
 147   1              distance1 = chaoshengbo();
 148   1              
 149   1              T0count3 = 0;
 150   1              angle = 1;   //右转动45度
 151   1              delay(400);
 152   1              distance2 = chaoshengbo();
 153   1              contral_0();
 154   1      }
 155          
 156          void system(void)
 157          {
 158   1              Car_Go();
 159   1              distance3 = chaoshengbo();
 160   1              if(distance3 <= Targetdistance)
 161   1              {
 162   2                      Car_Stop();
 163   2                      delay(200);
 164   2                      contral();
 165   2                      if(distance1 >= distance2)
 166   2                      {
 167   3                              Car_LeftGo();
 168   3                              delay(30);
 169   3                              Car_Stop();
 170   3                              delay(100);
 171   3                              Car_Go();
 172   3                      }
 173   2                      else 
 174   2                      {
 175   3                              Car_RightGo();
 176   3                              delay(30);
 177   3                              Car_Stop();
 178   3                              delay(100);
C51 COMPILER V9.59.0.0   CAR                                                               12/29/2023 20:28:54 PAGE 4   

 179   3                              Car_Go();
 180   3                      }
 181   2              }
 182   1              else
 183   1              {
 184   2                      Car_Go();               
 185   2              }
 186   1      }
 187          
 188          
 189          void system_xunji(void)
 190          {
 191   1              //Car_Go();
 192   1              contral_0();
 193   1              distance3 = chaoshengbo();
 194   1              if(distance3 <= Targetdistance)
 195   1              {
 196   2                      Car_Stop();
 197   2                      delay(200);
 198   2                      contral();
 199   2                      if(distance1 >= distance2)
 200   2                      {
 201   3                              Car_LeftGo();
 202   3                              delay(25);
 203   3                              Car_Stop();
 204   3                              delay(100);
 205   3                              Car_Go();
 206   3                              delay(25);
 207   3                              Car_RightGo();
 208   3                              delay(25);
 209   3                              Car_Go();
 210   3                              delay(25);
 211   3                      }
 212   2                      else 
 213   2                      {
 214   3                              Car_RightGo();
 215   3                              delay(25);
 216   3                              Car_Stop();
 217   3                              delay(100);
 218   3                              Car_Go();
 219   3                              delay(25);
 220   3                              Car_LeftGo();
 221   3                              delay(25);
 222   3                              Car_Go();
 223   3                              delay(25);
 224   3                      }
 225   2              }
 226   1              else
 227   1              {
 228   2                      Car_Go();               
 229   2              }
 230   1      }
 231          
 232          
 233          
 234          
 235          
 236          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    449    ----
C51 COMPILER V9.59.0.0   CAR                                                               12/29/2023 20:28:54 PAGE 5   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
