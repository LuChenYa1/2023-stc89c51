C51 COMPILER V9.59.0.0   MAIN                                                              11/07/2023 19:08:12 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGF51RC.H>
   2          #include <Timer0_Init.h>
   3          #include <nixie.h>
   4          #include <INT0_Init.h>
   5          #include <Key.h>
   6          
   7          #define Start 1
   8          #define Stop  0
   9          #define uint8_t  unsigned char
  10          uint8_t h = 23, m = 59, s = 56, State, KeyNum, Mode, Flag_INC_DEC, ht, mt, st, Flag_Mode;
  11          void Get_Mode(void);
  12          void nixie_Show(void);
  13          
  14          void main()
  15          {
  16   1              Timer0_Init();
  17   1              INT0_Init();
  18   1              
  19   1              while(1)
  20   1              {
  21   2                       Get_Mode();
  22   2                       nixie_Show();
  23   2                       if(Flag_INC_DEC == 1)//进入暂停自加自减模式
  24   2                       {
  25   3                               if(KeyNum == 1)  //按下1，自加一次
  26   3                               {
  27   4                                       s ++;
  28   4                                       if(s == 60)
  29   4                                       {
  30   5                                               s = 0;
  31   5                                               m ++;
  32   5                                               if(m == 60)
  33   5                                               {
  34   6                                                       m = 0;
  35   6                                                       h ++;
  36   6                                                       if(h == 24) h = 0;
  37   6                                               }
  38   5                                       }
  39   4                               }      
  40   3                               else if(KeyNum == 2)//按下2，自减一次
  41   3                               {
  42   4                                       s --;
  43   4                                       if(s == 0)
  44   4                                       {
  45   5                                               s = 59;
  46   5                                               if(m != 0)m --;
  47   5                                               if(m == 0)
  48   5                                               {
  49   6                                                       m = 59;
  50   6                                                       if(h != 0)h--;
  51   6                                                       if(h == 0) h = 23;
  52   6                                               }
  53   5                                        }
  54   4                                }
C51 COMPILER V9.59.0.0   MAIN                                                              11/07/2023 19:08:12 PAGE 2   

  55   3                               else if(KeyNum == 3)//按下3，解除暂停自加自减模式
  56   3                               {
  57   4                                       ht = h; mt = m; st = s; 
  58   4                                       Flag_INC_DEC = 0; 
  59   4                               }
  60   3                       }
  61   2              }
  62   1      }
  63          
  64          //得到模式
  65          void Get_Mode(void)
  66          {
  67   1              KeyNum = Key();
  68   1              if(KeyNum == 1)Mode = 1;
  69   1              else if(KeyNum == 2)Mode = 2;
  70   1              else if(KeyNum == 3)Mode = 3;
  71   1              else if(KeyNum == 4)Mode = 4;
  72   1      }
  73          
  74          //刷新显示
  75          void nixie_Show(void)
  76          {
  77   1              nixie(3, 17);//显示分隔号
  78   1              nixie(6, 17);
  79   1              
  80   1              nixie(1, h / 10);
  81   1              nixie(2, h % 10);
  82   1              
  83   1              nixie(4, m / 10);
  84   1              nixie(5, m % 10);
  85   1              
  86   1              nixie(7, s / 10);
  87   1              nixie(8, s % 10);
  88   1      }
  89          
  90          //定时中断函数
  91          void Timer0_Routine () interrupt 1
  92          {
  93   1              static unsigned int T0count;     //静态局部变量，保证不会被重新赋值
  94   1      
  95   1              TL0 = 0x66;                                      //确保中断时间不变
  96   1              TH0 = 0xFC;     
  97   1              T0count++;
  98   1              Key_Loop();
  99   1              if(T0count == 1000)              //每隔1000毫秒进入if，灯亮灭变化
 100   1              {
 101   2                      T0count=0;
 102   2                      if(State == Start)
 103   2                      {
 104   3                              if(Mode == 1)            //一号键顺计时
 105   3                              {
 106   4                                      if(Flag_INC_DEC == 0)
 107   4                                      {
 108   5                                              if(Flag_Mode == 1)
 109   5                                              {
 110   6                                                      Flag_Mode = 0;
 111   6                                                      h = ht; m = mt; s = st;
 112   6                                              }
 113   5                                              s ++;
 114   5                                              if(s == 60)
 115   5                                              {
 116   6                                                      s = 0;
C51 COMPILER V9.59.0.0   MAIN                                                              11/07/2023 19:08:12 PAGE 3   

 117   6                                                      m ++;
 118   6                                                      if(m == 60)
 119   6                                                      {
 120   7                                                              m = 0;
 121   7                                                              h ++;
 122   7                                                              if(h == 24) h = 0;
 123   7                                                      }
 124   6                                              }
 125   5                                      }
 126   4                              }
 127   3                              else if(Mode == 2)       //二号键倒计时
 128   3                              {
 129   4                                      if(Flag_INC_DEC == 0)
 130   4                                      {
 131   5                                              if(Flag_Mode == 1)
 132   5                                              {
 133   6                                                      Flag_Mode = 0;
 134   6                                                      h = ht; m = mt; s = st;
 135   6                                              }
 136   5                                              if(s != 0)s --;
 137   5                                              if(s == 0)
 138   5                                              {
 139   6                                                      s = 59;
 140   6                                                      if(m != 0)m --;
 141   6                                                      if(m == 0)
 142   6                                                      {
 143   7                                                              m = 59;
 144   7                                                              if(h != 0)h--;
 145   7                                                              if(h == 0) h = 23;
 146   7                                                      }
 147   6                                              }
 148   5                                      }
 149   4                              }
 150   3                              else if(Mode == 3)      //三号键归零
 151   3                              {
 152   4                                      if(Flag_INC_DEC == 0)
 153   4                                      {
 154   5                                              h = 0; m = 0; s = 0;
 155   5                                      }
 156   4                              }
 157   3                              else if(Mode == 4)      //四号键暂停
 158   3                              {
 159   4                                      Flag_INC_DEC = 1;   //进入暂停自加自减模式
 160   4                                      Flag_Mode = 1;
 161   4                              }
 162   3                      }
 163   2                      
 164   2              }
 165   1      }
 166          
 167          //外部中断函数
 168          void int0_Routine() interrupt 0
 169          {
 170   1              State = !State;
 171   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    571    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   MAIN                                                              11/07/2023 19:08:12 PAGE 4   

   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
