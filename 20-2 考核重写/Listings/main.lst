C51 COMPILER V9.59.0.0   MAIN                                                              05/16/2023 22:11:50 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "nixie.h"
   3          #include "Timer0_Init.h"
   4          #include "Key.h"
   5          #include "UART.h"
   6          #include "delay.h"
   7          #include "stdio.h"
   8          
   9          
  10          void nixie_Show();//显示当前所有时间
  11          
  12          unsigned char hour=23,minute=59,second=56;//初始时间
  13          unsigned char RunFlag,FlashFlag;//运行，闪烁
  14          unsigned char TimeTypeSelect;//时间类型选择
  15          unsigned char KeyNum;
  16          char str[10];
  17          
  18          void main ()
  19          {       
  20   1      
  21   1              UART_Init();
  22   1              Timer0_Init();
  23   1      
  24   1          while(1)
  25   1              {
  26   2                      nixie(6,17);
  27   2                      nixie(3,17);
  28   2                      KeyNum=Key();           
  29   2                      if(KeyNum)
  30   2                      {
  31   3                              if(P2&0x01)//注意技巧：不能写P2&0X01==1，此条件永不成立
  32   3                              {
  33   4                              P2&=0xfe;
  34   4                              }
  35   3                          else if(~(P2&0x01))//D1翻转电平，这个if/else的顺序很重要，内容不能颠倒
  36   3                              {
  37   4                                      P2|=0x01;
  38   4                              }
  39   3                          
  40   3                              if(KeyNum==1)//时间类型选择
  41   3                              {
  42   4                                      TimeTypeSelect++;//0.1.2.3.4
  43   4                                      TimeTypeSelect%=5;
  44   4                              }
  45   3                              if(KeyNum==2)
  46   3                              {
  47   4                                      if(TimeTypeSelect==1)//时加一
  48   4                                      {
  49   5                                              hour++;
  50   5                                              hour%=24;
  51   5                                      }
  52   4                                      if(TimeTypeSelect==2)//分加一
  53   4                                      {
  54   5                                              minute++;
C51 COMPILER V9.59.0.0   MAIN                                                              05/16/2023 22:11:50 PAGE 2   

  55   5                                              minute%=60;
  56   5                                      }
  57   4                                      if(TimeTypeSelect==3)//秒加一
  58   4                                      {
  59   5                                              second++;
  60   5                                              second%=60;
  61   5                                      }
  62   4                              }
  63   3                              if(KeyNum==3)
  64   3                              {
  65   4                                      if(TimeTypeSelect==1)//时减一
  66   4                                      {
  67   5                                              hour--;
  68   5                                              if(hour==255)hour=23;
  69   5                                      }
  70   4                                      if(TimeTypeSelect==2)//分减一
  71   4                                      {
  72   5                                              minute--;
  73   5                                              if(minute==255)minute=59;
  74   5                                      }
  75   4                                      if(TimeTypeSelect==3)//秒减一
  76   4                                      {
  77   5                                              second--;
  78   5                                              if(second==255)second=59;
  79   5                                      }
  80   4                                      if(TimeTypeSelect==4)
  81   4                                      {
  82   5                                              hour=0;
  83   5                                              minute=0;
  84   5                                              second=0;
  85   5                                      }
  86   4                              }
  87   3                              if(KeyNum==4)
  88   3                              {
  89   4                                      if(TimeTypeSelect==1)
  90   4                                      {
  91   5                                              hour=0;
  92   5                                      }
  93   4                                      if(TimeTypeSelect==2)
  94   4                                      {
  95   5                                              minute=0;
  96   5                                      }
  97   4                                      if(TimeTypeSelect==3)
  98   4                                      {
  99   5                                              second=0;
 100   5                                      }
 101   4                                      if(TimeTypeSelect==4)
 102   4                                      {
 103   5      //                                      UART_SendByte(hour/10+0x30);
 104   5      //                                      UART_SendByte(hour%10+0x30);
 105   5      //                                      UART_SendByte(0x3a);//:
 106   5      //                                      UART_SendByte(minute/10+0x30);
 107   5      //                                      UART_SendByte(minute%10+0x30);
 108   5      //                                      UART_SendByte(0x3a);
 109   5      //                                      UART_SendByte(second/10+0x30);
 110   5      //                                      UART_SendByte(second%10+0x30);
 111   5      //                                      
 112   5      //                                      UART_SendByte('\r');//\r
 113   5      //                                      UART_SendByte('\n');//\n
 114   5                                              //sprintf(str,"%d:%d:%d\r\n",hour,minute,second);
 115   5                                              sprintf(str,"%d",123);
 116   5                                              Uart_SendString(str);
C51 COMPILER V9.59.0.0   MAIN                                                              05/16/2023 22:11:50 PAGE 3   

 117   5                                      }
 118   4                              }
 119   3                      }
 120   2                      if(TimeTypeSelect==0)//0暂停
 121   2                      {
 122   3                              RunFlag=0;
 123   3                              
 124   3                              P2|=0xE0;
 125   3                              P2&=0xfd;
 126   3                              nixie_Show();
 127   3                      }
 128   2                      if(TimeTypeSelect==4)//4开始计时
 129   2                      {
 130   3                              RunFlag=1;
 131   3                              P2|=0xE0;
 132   3                              P2|=0x02;
 133   3                              nixie_Show();
 134   3                      }
 135   2                      if(TimeTypeSelect==1)//1时闪烁
 136   2                      {
 137   3                              RunFlag=0;
 138   3                              P2&=0xfd;
 139   3                              if(FlashFlag==1)
 140   3                              {
 141   4                                      P2&=0xDF;
 142   4                                      nixie(8,16);
 143   4                                      nixie(7,16);
 144   4                                      nixie(5,minute/10);
 145   4                                      nixie(4,minute%10);
 146   4                                      nixie(2,second/10);
 147   4                                      nixie(1,second%10);
 148   4                              }
 149   3                              else
 150   3                              {
 151   4                                      P2|=0xE0;
 152   4                                      nixie_Show();
 153   4                              }
 154   3                      }
 155   2                      if(TimeTypeSelect==2)//2分闪烁
 156   2                      {
 157   3                              RunFlag=0;
 158   3                              if(FlashFlag==1)
 159   3                              {
 160   4                                      P2&=0xBF;
 161   4                                      nixie(8,hour/10);
 162   4                                      nixie(7,hour%10);
 163   4                                      nixie(5,16);
 164   4                                      nixie(4,16);
 165   4                                      nixie(2,second/10);
 166   4                                      nixie(1,second%10);
 167   4                              }
 168   3                              else
 169   3                              {
 170   4                                      P2|=0xE0;
 171   4                                      nixie_Show();
 172   4                              }
 173   3                      }
 174   2                      if(TimeTypeSelect==3)//3秒闪烁
 175   2                      {
 176   3                              RunFlag=0;
 177   3                              if(FlashFlag==1)
 178   3                              {
C51 COMPILER V9.59.0.0   MAIN                                                              05/16/2023 22:11:50 PAGE 4   

 179   4                                      P2&=0x7F;
 180   4                                      nixie(8,hour/10);
 181   4                                      nixie(7,hour%10);
 182   4                                      nixie(5,minute/10);
 183   4                                      nixie(4,minute%10 );
 184   4                                      nixie(2,16);
 185   4                                      nixie(1,16);
 186   4                              }
 187   3                              else
 188   3                              {
 189   4                                      P2|=0xE0;
 190   4                                      nixie_Show();
 191   4                              }
 192   3                      }
 193   2                      
 194   2      
 195   2              }
 196   1      }
 197           
 198          void nixie_Show()//显示当前所有时间
 199          {
 200   1                      nixie(8,hour/10); 
 201   1                      nixie(7,hour%10);
 202   1                      nixie(5,minute/10);
 203   1                      nixie(4,minute%10);
 204   1                      nixie(2,second/10);
 205   1                      nixie(1,second%10);
 206   1      }
 207          void Clock_Loop()
 208          {
 209   1              if(RunFlag)
 210   1              {
 211   2                      second++;
 212   2                      if(second==60)
 213   2                      {
 214   3                              second=0;minute++;
 215   3                              if(minute==60)
 216   3                              {
 217   4                                      minute=0;
 218   4                                      hour++;
 219   4                                      if(hour==24)
 220   4                                      {
 221   5                                              hour=0;
 222   5                                      }
 223   4                              }
 224   3                      }
 225   2              }
 226   1      }
 227          
 228          void Timer0_Routine () interrupt 1
 229          {
 230   1              static unsigned int T0count1,T0count2,T0count3,T0count4;     //静态局部变量，保证不会被重新赋值
 231   1      
 232   1              TL0 = 0x66;                                      //确保中断时间不变
 233   1              TH0 = 0xFC;     
 234   1              T0count1++;
 235   1              if(T0count1 == 400)              //每隔1000毫秒进入if，灯亮灭变化
 236   1              {
 237   2                      T0count1=0;
 238   2                      Clock_Loop();
 239   2              }
 240   1              T0count2++;
C51 COMPILER V9.59.0.0   MAIN                                                              05/16/2023 22:11:50 PAGE 5   

 241   1              if(T0count2==1)//定时器扫描数码管
 242   1              {
 243   2                      T0count2=0;
 244   2                      nixie_Loop();
 245   2              }
 246   1              T0count3++;
 247   1              if(T0count3==250)//0.25秒闪烁
 248   1              {
 249   2                      T0count3=0;
 250   2                      FlashFlag=!FlashFlag;
 251   2              }
 252   1              T0count4++;
 253   1              if(T0count4==10)//定时器扫描按键
 254   1              {
 255   2                      T0count4=0;
 256   2                      Key_Loop();
 257   2              }
 258   1      }
 259          
 260          
 261          
 262          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    902    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
